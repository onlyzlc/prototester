(function(t){function e(e){for(var s,n,o=e[0],u=e[1],l=e[2],p=0,d=[];p<o.length;p++)n=o[p],Object.prototype.hasOwnProperty.call(i,n)&&i[n]&&d.push(i[n][0]),i[n]=0;for(s in u)Object.prototype.hasOwnProperty.call(u,s)&&(t[s]=u[s]);c&&c(e);while(d.length)d.shift()();return a.push.apply(a,l||[]),r()}function r(){for(var t,e=0;e<a.length;e++){for(var r=a[e],s=!0,o=1;o<r.length;o++){var u=r[o];0!==i[u]&&(s=!1)}s&&(a.splice(e--,1),t=n(n.s=r[0]))}return t}var s={},i={app:0},a=[];function n(e){if(s[e])return s[e].exports;var r=s[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=s,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(r,s,function(e){return t[e]}.bind(null,s));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],u=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var c=u;a.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"034f":function(t,e,r){"use strict";var s=r("85ec"),i=r.n(s);i.a},"38be":function(t,e,r){},"56d7":function(t,e,r){"use strict";r.r(e);r("b0c0"),r("d3b7"),r("e260"),r("e6cf"),r("cca6"),r("a79d");var s=r("2b0e"),i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[t.Store.state.isVerified?r("div",{attrs:{id:"nav"}},[r("div",{staticClass:"links"},[r("router-link",{attrs:{to:"/tasks"}},[t._v(" 测试任务 ")]),t._v(" | "),r("router-link",{attrs:{to:"/setting"}},[t._v(" 设置 ")])],1),r("div",{staticClass:"right"},[r("div",[t._v(" "+t._s(t.Store.state.email)+" | "),r("button",{on:{click:function(e){t.visibility.logoutConfirm=!0}}},[t._v(" 退出 ")])])])]):t._e(),r("router-view"),r("ln-dialog",{attrs:{title:"确定注销吗",vis:t.visibility.logoutConfirm},on:{click_primary:t.logout,click_secondary:function(e){t.visibility.logoutConfirm=!1}}})],1)},a=[],n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.vis?r("div",{staticClass:"dialog_container"},[r("div",{staticClass:"dialog_panel"},[r("div",{staticClass:"dialog_header"},[r("h3",[t._v(t._s(t.title))]),r("i",{staticClass:"close",on:{click:function(e){return t.$emit("cancel")}}})]),r("div",{staticClass:"dialog_content"},[t._t("default")],2),r("div",{staticClass:"dialog_foot"},[r("div",{staticClass:"left"},[t._t("foot_left")],2),r("div",{staticClass:"right"},[t._t("foot_right",[r("button",{staticClass:"primary",on:{click:function(e){return t.$emit("click_primary")}}},[t._v(" "+t._s(t.btnPrimary)+" ")]),r("button",{staticClass:"secondary",on:{click:function(e){return t.$emit("click_secondary")}}},[t._v(" "+t._s(t.btnSecondary)+" ")])])],2)])])]):t._e()},o=[],u={name:"DialogLn",props:{title:{type:String,default:"对话框"},vis:{type:Boolean,default:!1},btnPrimary:{type:String,default:"确定"},btnSecondary:{type:String,default:"取消"}}},l=u,c=(r("dbdc"),r("2877")),p=Object(c["a"])(l,n,o,!1,null,"d0c59e9a",null),d=p.exports,m={components:{LnDialog:d},data:function(){return{visibility:{logoutConfirm:!1}}},computed:{},methods:{logout:function(){var t=this;this.$http.post("/logout").then((function(e){200===e.status&&(t.Store.clear(),t.$router.push({name:"Login"}),t.visibility.logoutConfirm=!1,t.Store.debug&&console.log("已注销"))}))}}},f=m,h=(r("034f"),Object(c["a"])(f,i,a,!1,null,null,null)),v=h.exports,b=r("8c4f"),g=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("main",[r("form",{on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[r("div",[r("label",{attrs:{for:"email"}},[t._v("邮箱")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.user.email,expression:"user.email"}],attrs:{id:"email",type:"email",autocomplete:"username",name:"email",required:""},domProps:{value:t.user.email},on:{input:function(e){e.target.composing||t.$set(t.user,"email",e.target.value)}}})]),r("div",[r("label",{attrs:{for:"password"}},[t._v("密码")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.user.password,expression:"user.password"}],attrs:{id:"password",type:"password",autocomplete:"current-password",name:"password",required:""},domProps:{value:t.user.password},on:{input:function(e){e.target.composing||t.$set(t.user,"password",e.target.value)}}})]),t.errorTip?r("div",{staticClass:"errorTip"},[t._v(" "+t._s(t.errorTip)+" ")]):t._e(),r("button",{attrs:{type:"submit"}},[t._v(" 登录 ")]),t._m(0)])])},_=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("p",[t._v(" 没有账号？ "),r("a",{attrs:{href:"/regist"}},[t._v("注册")])])}],y={props:{to:{type:String,default:"Tasks"}},data:function(){return{user:{email:"",password:"",isVerified:!1},errorTip:""}},computed:{},methods:{submit:function(){var t=this;this.$http.post("/login",this.user).then((function(e){return t.handler(e)})).catch((function(){if(t.retryTimmer)return!1;t.errorTip="网络似乎有问题, 连不上服务器，正在重试...",t.retryTimmer=setInterval(t.submit,3e3)}))},handler:function(t){switch(this.retryTimmer&&clearInterval(this.retryTimmer),this.errorTip="",t.data.ret_code){case 0:this.user.isVerified=!0,this.Store.updateUser(this.user),this.$router.push({name:this.to});break;case 1:this.errorTip="用户名或密码错误";break;case 2:this.errorTip="用户不存在";break;default:this.errorTip="系统错误, 请稍后再试";break}}}},k=y,w=Object(c["a"])(k,g,_,!1,null,null,null),S=w.exports,T=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("main",[r("form",{on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[r("div",[r("label",{attrs:{for:"email"}},[t._v("邮箱")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.user.email,expression:"user.email"}],attrs:{id:"email",type:"email",name:"email",required:""},domProps:{value:t.user.email},on:{input:function(e){e.target.composing||t.$set(t.user,"email",e.target.value)}}})]),r("div",[r("label",{attrs:{for:"password"}},[t._v("密码")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.user.password,expression:"user.password"}],attrs:{id:"password",type:"password",required:""},domProps:{value:t.user.password},on:{input:function(e){e.target.composing||t.$set(t.user,"password",e.target.value)}}})]),r("div",[r("label",{attrs:{for:"password"}},[t._v("确认密码")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.user.passwordConfirm,expression:"user.passwordConfirm"}],attrs:{id:"password",type:"password",required:""},domProps:{value:t.user.passwordConfirm},on:{input:function(e){e.target.composing||t.$set(t.user,"passwordConfirm",e.target.value)}}})]),t.errorTip?r("div",{staticClass:"errorTip"},[t._v(" "+t._s(t.errorTip)+" ")]):t._e(),r("button",{attrs:{type:"submit"}},[t._v(" 注册 ")]),t._m(0)])])},C=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("p",[t._v(" 已有账号？ "),r("a",{attrs:{href:"/login"}},[t._v("去登录")])])}],$=(r("caad"),r("2532"),{props:{to:{type:String,default:"Tasks"}},data:function(){return{user:{email:"",password:"",passwordConfirm:"",isVerified:!1},existingEmail:[],abnormal:""}},computed:{errorTip:function(){return this.abnormal?this.abnormal:this.existingEmail.includes(this.user.email)?"此用户已存在":""!==this.user.password&&""!==this.user.passwordConfirm&&this.user.password!==this.user.passwordConfirm&&"两次输入密码不一致"}},methods:{submit:function(){var t=this;if(this.errorTip)return!1;this.$http.post("/regist",this.user).then((function(e){return t.handler(e)})).catch((function(e){t.abnormal="网络异常, 无法连接服务器."}))},handler:function(t){switch(t.data.ret_code){case 0:this.user.isVerified=!0,this.Store.updateUser(this.user),this.$router.push({name:this.to});break;case 1:this.existingEmail.push(this.user.email);break;case 2:this.$router.push({name:"Login"});break}}}}),x=$,O=Object(c["a"])(x,T,C,!1,null,null,null),j=O.exports,I=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("button",{on:{click:function(e){return t.$router.push({name:"CreateTask"})}}},[t._v(" 新增测试任务 ")]),r("ul",t._l(t.tasks,(function(e,s){return r("li",{key:e.taskId},[r("a",{attrs:{href:"/tasks/"+e.taskId}},[t._v(" "+t._s(e.name)+" ")]),t._v(" | "),r("span",{staticClass:"status"},[t._v(t._s("unpublished"==e.status?"已撤下":"已发布"))]),t._v(" | "),r("a",{attrs:{href:"/tasks/"+e.taskId+"/setting"}},[t._v("设置步骤")]),t._v(" | "),r("a",{attrs:{href:"/tasks/"+e.taskId+"/testing"}},[t._v("开始测试")]),t._v(" | "),r("button",{staticClass:"publish",on:{click:function(e){return t.publish(s)}}},[t._v(" "+t._s("unpublished"==e.status?"发布":"撤下")+" ")])])})),0)])},P=[],E={data:function(){return{tasks:[],newTask:{name:"",description:""}}},watch:{$route:"fetchData"},created:function(){this.fetchData()},methods:{fetchData:function(){var t=this;this.$http.get("/tasks").then((function(e){Array.isArray(e.data)?t.tasks=e.data:t.Store.debug&&console.error("数据传输类型错误")})).catch((function(t){return console.error(t)}))},publish:function(t){var e=this.tasks[t],r="published"===e.status?"unpublished":"published";this.$http.patch("/tasks/"+e.taskId+"/status",{status:r}).then((function(){e.status=r})).catch((function(t){console.log(t)}))}}},D=E,L=Object(c["a"])(D,I,P,!1,null,null,null),V=L.exports,N=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("form",{on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[r("label",{attrs:{for:"ipturl"}},[t._v("原型链接")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.ipturl,expression:"ipturl"}],attrs:{id:"ipturl",name:"ipturl",type:"url",placeholder:"http://protomanager.com/yourproto",required:""},domProps:{value:t.ipturl},on:{input:function(e){e.target.composing||(t.ipturl=e.target.value)}}}),r("button",{attrs:{type:"submit"}},[t._v("确定")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.retry,expression:"retry"}],attrs:{type:"checkbox",id:"retry"},domProps:{checked:Array.isArray(t.retry)?t._i(t.retry,null)>-1:t.retry},on:{change:function(e){var r=t.retry,s=e.target,i=!!s.checked;if(Array.isArray(r)){var a=null,n=t._i(r,a);s.checked?n<0&&(t.retry=r.concat([a])):n>-1&&(t.retry=r.slice(0,n).concat(r.slice(n+1)))}else t.retry=i}}}),r("label",{attrs:{for:"retry"}},[t._v("自动重试")])]),r("iframe",{attrs:{src:t.iframeSrc,frameborder:"0"}}),""!==t.iframeSrc?[""!==t.urlState?r("div",{staticClass:"tip",domProps:{innerHTML:t._s(t.urlState)}}):t._e(),t.pass?r("button",[t._v("从这个页面上创建任务")]):t._e(),r("div",{attrs:{id:"capture"}},[r("div",{staticClass:"thumbnail",style:{backgroundImage:"url("+t.thumbnail+")"}})])]:t._e()],2)},q=[],M=(r("3ca3"),r("2ca0"),r("498a"),r("ddb0"),r("2b3d"),{data:function(){return{ipturl:"",iframeSrc:"",urlState:"",pass:!1,retry:!1,retryDur:6e3,thumbnail:""}},watch:{ipturl:function(){this.ipturl.startsWith("http://")||this.ipturl.startsWith("https://")?this.urlState="":this.urlState="地址应以 'http://'或'https://' 开头"}},mounted:function(){window.addEventListener("message",this.receiveMsgFromWin,!1)},methods:{submit:function(){var t=this.ipturl.trim();return""!==t&&t!==this.iframeSrc&&(!(!t.startsWith("http:")&&!t.startsWith("https:"))&&(this.reloadTimer&&clearInterval(this.reloadTimer),this.urlState="正在检查地址...",this.iframeSrc=t,this.pass=!1,void(this.reloadTimer=setInterval(this.reload,this.retryDur,t))))},receiveMsgFromWin:function(t){if(""!==this.iframeSrc){var e=t.data,r=t.origin;try{if(new URL(this.iframeSrc).origin===t.origin)switch(this.Store.debug&&console.info("收到 %s 的消息： %o",r,e),e.status){case"init":this.urlState="稍等一下...",this.iframeSrc=e.url,clearInterval(this.reloadTimer);break;case"isReady":clearInterval(this.reloadTimer),this.urlState="",this.thumbnail=e.imageData,this.pass=!0;break}else this.Store.debug&&console.log("消息来源不是用户输入的地址")}catch(s){this.Store.debug&&console.error(s)}}},reload:function(t){var e=this;if(this.urlState="此地址或许没有加入插件，<a href='/help'>如何给原型添加插件？</a>",this.retry){this.urlState+=", 正在刷新重试...",this.iframeSrc="";var r=t;setTimeout((function(){e.iframeSrc=r}),this.retryDur/2)}else clearInterval(this.reloadTimer)}}}),R=M,A=(r("d93b"),Object(c["a"])(R,N,q,!1,null,null,null)),W=A.exports,U=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t._v("这里显示测试的统计信息")])},J=[],B={},F=B,H=Object(c["a"])(F,U,J,!1,null,null,null),z=H.exports,G=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t._v("显示测试详细信息")])},K=[],Q={},X=Q,Y=Object(c["a"])(X,G,K,!1,null,null,null),Z=Y.exports,tt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t._v("测试进行中...")])},et=[],rt={},st=rt,it=Object(c["a"])(st,tt,et,!1,null,null,null),at=it.exports,nt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[t._v("这里可以进行账号等设置")])},ot=[],ut={},lt=ut,ct=Object(c["a"])(lt,nt,ot,!1,null,null,null),pt=ct.exports;s["a"].use(b["a"]);var dt=[{path:"/",alias:"/tasks",name:"Tasks",component:V},{path:"/tasks/new",name:"CreateTask",component:W},{path:"/tasks/:taskId",name:"TaskBoard",component:z},{path:"/tasks/:taskId/testId",name:"TestDetail",component:Z},{path:"/tasks/:taskId/testing",name:"Testing",component:at},{path:"/setting",name:"Setting",component:pt},{path:"/login",name:"Login",component:S,props:{to:"Tasks"}},{path:"/regist",name:"Regist",component:j,props:{to:"Tasks"}}],mt=new b["a"]({mode:"history",base:"/",routes:dt}),ft=mt,ht=r("82ae"),vt=r.n(ht),bt=r("a7fe"),gt=r.n(bt),_t={debug:!1,state:{isVerified:!1,email:""},init:function(){var t=localStorage.getItem("state");t?(this.state=JSON.parse(t),this.debug&&console.log("从本地存储获取初始状态,登录状态:"+this.state.isVerified)):this.debug&&console.log("本地存储为空, 状态保持默认值")},save:function(){localStorage.setItem("state",JSON.stringify(this.state))},updateUser:function(t){this.debug&&console.log("更新用户状态信息:%o",t);var e=t.isVerified,r=t.email;this.state.isVerified=e,this.state.email=r,this.save()},clear:function(){this.state.isVerified=!1,this.state.email="",this.save()}};console.log("production"),s["a"].config.productionTip=!1,_t.init(),s["a"].prototype.Store=_t;var yt=vt.a.create({baseURL:"/api"});yt.interceptors.response.use((function(t){return t}),(function(t){return _t.debug&&console.log(t),511===t.response.status&&(sessionStorage.clear("user"),sessionStorage.setItem("urlReq",t.config.url),_t.clear(),ft.push({name:"Login"})),Promise.reject(t)})),ft.beforeEach((function(t,e,r){var s=_t.state;"Regist"===t.name||"Login"===t.name||s.isVerified?r():(_t.debug&&console.log("登录超时, 跳转注册页"),r({name:"Regist",props:{to:t.name}}))})),s["a"].use(gt.a,yt),new s["a"]({beforeCreate:function(){},created:function(){},methods:{},router:ft,render:function(t){return t(v)}}).$mount("#app")},"85ec":function(t,e,r){},c3a1:function(t,e,r){},d93b:function(t,e,r){"use strict";var s=r("38be"),i=r.n(s);i.a},dbdc:function(t,e,r){"use strict";var s=r("c3a1"),i=r.n(s);i.a}});
//# sourceMappingURL=app.225abfa4.js.map